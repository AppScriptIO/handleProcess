"use strict";var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports, "__esModule", { value: true });exports.ManageSubprocess = void 0;var _events = _interopRequireDefault(require("events"));
var _child_process = _interopRequireDefault(require("child_process"));



class ManageSubprocess extends _events.default {


  static terminateSubprocess() {
    for (let subprocess of ManageSubprocess.subprocessList) {
      if (!subprocess.killed) {

        subprocess.kill('SIGTERM');
      }
    }
  }





  constructor({ cliAdapterPath }) {
    super();
    this.cliAdapterPath = cliAdapterPath;
    this.suprocess = null;
  }

  runInSubprocess() {
    if (this.subprocess) this.subprocess.kill('SIGTERM');

    this.argumentList = [...(arguments.length == 0 ? this.argumentList || [] : arguments)];

    let stringifyArgs = JSON.stringify(this.argumentList);

    this.subprocess = _child_process.default.
    fork(this.cliAdapterPath, [stringifyArgs], {
      stdio: [0, 1, 2, 'ipc'],
      execArgv: [

      '--no-lazy'] }).


    on('message', message => {
      if ((message === null || message === void 0 ? void 0 : message.status) == 'ready') this.emit('ready');
    }).
    on('close', code => {
      if (code === 8) console.error('Error detected, waiting for changes.');
    });


    this.subprocess.on('exit', (code, signal) => console.log(`[Subprocess ${this.subprocess.pid}]: signal ${signal}, code ${code};`));

    ManageSubprocess.subprocessList.push(this.subprocess);

    return this.subprocess;
  }}exports.ManageSubprocess = ManageSubprocess;ManageSubprocess.subprocessList = [];











process.on('SIGINT', (code, signal) => {
  console.log(`[Process ${process.pid}]: signal ${signal}, code ${code};`);
  ManageSubprocess.terminateSubprocess();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NvdXJjZS9tYW5hZ2VTdWJwcm9jZXNzLmpzIl0sIm5hbWVzIjpbIk1hbmFnZVN1YnByb2Nlc3MiLCJFdmVudEVtaXR0ZXIiLCJ0ZXJtaW5hdGVTdWJwcm9jZXNzIiwic3VicHJvY2VzcyIsInN1YnByb2Nlc3NMaXN0Iiwia2lsbGVkIiwia2lsbCIsImNvbnN0cnVjdG9yIiwiY2xpQWRhcHRlclBhdGgiLCJzdXByb2Nlc3MiLCJydW5JblN1YnByb2Nlc3MiLCJhcmd1bWVudExpc3QiLCJhcmd1bWVudHMiLCJsZW5ndGgiLCJzdHJpbmdpZnlBcmdzIiwiSlNPTiIsInN0cmluZ2lmeSIsImNoaWxkUHJvY2VzcyIsImZvcmsiLCJzdGRpbyIsImV4ZWNBcmd2Iiwib24iLCJtZXNzYWdlIiwic3RhdHVzIiwiZW1pdCIsImNvZGUiLCJjb25zb2xlIiwiZXJyb3IiLCJzaWduYWwiLCJsb2ciLCJwaWQiLCJwdXNoIiwicHJvY2VzcyJdLCJtYXBwaW5ncyI6ImtNQUFBO0FBQ0E7Ozs7QUFJTyxNQUFNQSxnQkFBTixTQUErQkMsZUFBL0IsQ0FBNEM7OztBQUdqRCxTQUFPQyxtQkFBUCxHQUE2QjtBQUMzQixTQUFLLElBQUlDLFVBQVQsSUFBdUJILGdCQUFnQixDQUFDSSxjQUF4QyxFQUF3RDtBQUN0RCxVQUFJLENBQUNELFVBQVUsQ0FBQ0UsTUFBaEIsRUFBd0I7O0FBRXRCRixRQUFBQSxVQUFVLENBQUNHLElBQVgsQ0FBZ0IsU0FBaEI7QUFDRDtBQUNGO0FBQ0Y7Ozs7OztBQU1EQyxFQUFBQSxXQUFXLENBQUMsRUFBRUMsY0FBRixFQUFELEVBQXFCO0FBQzlCO0FBQ0EsU0FBS0EsY0FBTCxHQUFzQkEsY0FBdEI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCLElBQWpCO0FBQ0Q7O0FBRURDLEVBQUFBLGVBQWUsR0FBRztBQUNoQixRQUFJLEtBQUtQLFVBQVQsRUFBcUIsS0FBS0EsVUFBTCxDQUFnQkcsSUFBaEIsQ0FBcUIsU0FBckI7O0FBRXJCLFNBQUtLLFlBQUwsR0FBb0IsQ0FBQyxJQUFJQyxTQUFTLENBQUNDLE1BQVYsSUFBb0IsQ0FBcEIsR0FBd0IsS0FBS0YsWUFBTCxJQUFxQixFQUE3QyxHQUFrREMsU0FBdEQsQ0FBRCxDQUFwQjs7QUFFQSxRQUFJRSxhQUFhLEdBQUdDLElBQUksQ0FBQ0MsU0FBTCxDQUFlLEtBQUtMLFlBQXBCLENBQXBCOztBQUVBLFNBQUtSLFVBQUwsR0FBa0JjO0FBQ2ZDLElBQUFBLElBRGUsQ0FDVixLQUFLVixjQURLLEVBQ1csQ0FBQ00sYUFBRCxDQURYLEVBQzRCO0FBQzFDSyxNQUFBQSxLQUFLLEVBQUUsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVSxLQUFWLENBRG1DO0FBRTFDQyxNQUFBQSxRQUFRLEVBQUU7O0FBRVIsaUJBRlEsQ0FGZ0MsRUFENUI7OztBQVFmQyxJQUFBQSxFQVJlLENBUVosU0FSWSxFQVFEQyxPQUFPLElBQUk7QUFDeEIsVUFBSSxDQUFBQSxPQUFPLFNBQVAsSUFBQUEsT0FBTyxXQUFQLFlBQUFBLE9BQU8sQ0FBRUMsTUFBVCxLQUFtQixPQUF2QixFQUFnQyxLQUFLQyxJQUFMLENBQVUsT0FBVjtBQUNqQyxLQVZlO0FBV2ZILElBQUFBLEVBWGUsQ0FXWixPQVhZLEVBV0hJLElBQUksSUFBSTtBQUNuQixVQUFJQSxJQUFJLEtBQUssQ0FBYixFQUFnQkMsT0FBTyxDQUFDQyxLQUFSLENBQWMsc0NBQWQ7QUFDakIsS0FiZSxDQUFsQjs7O0FBZ0JBLFNBQUt4QixVQUFMLENBQWdCa0IsRUFBaEIsQ0FBbUIsTUFBbkIsRUFBMkIsQ0FBQ0ksSUFBRCxFQUFPRyxNQUFQLEtBQWtCRixPQUFPLENBQUNHLEdBQVIsQ0FBYSxlQUFjLEtBQUsxQixVQUFMLENBQWdCMkIsR0FBSSxhQUFZRixNQUFPLFVBQVNILElBQUssR0FBaEYsQ0FBN0M7O0FBRUF6QixJQUFBQSxnQkFBZ0IsQ0FBQ0ksY0FBakIsQ0FBZ0MyQixJQUFoQyxDQUFxQyxLQUFLNUIsVUFBMUM7O0FBRUEsV0FBTyxLQUFLQSxVQUFaO0FBQ0QsR0FsRGdELEMsNENBQXRDSCxnQixDQUNKSSxjLEdBQWlCLEU7Ozs7Ozs7Ozs7OztBQTZEMUI0QixPQUFPLENBQUNYLEVBQVIsQ0FBVyxRQUFYLEVBQXFCLENBQUNJLElBQUQsRUFBT0csTUFBUCxLQUFrQjtBQUNyQ0YsRUFBQUEsT0FBTyxDQUFDRyxHQUFSLENBQWEsWUFBV0csT0FBTyxDQUFDRixHQUFJLGFBQVlGLE1BQU8sVUFBU0gsSUFBSyxHQUFyRTtBQUNBekIsRUFBQUEsZ0JBQWdCLENBQUNFLG1CQUFqQjtBQUNELENBSEQiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgRXZlbnRFbWl0dGVyIGZyb20gJ2V2ZW50cydcbmltcG9ydCBjaGlsZFByb2Nlc3MgZnJvbSAnY2hpbGRfcHJvY2VzcydcblxuLy8gbWFuYWdlIGZvcmtlZCBzdWJwcm9jZXNzIGFsbG93aW5nIHRvIHJlc3RhcnQgdGhlIHN1YnByb2Nlc3Mgb24gZGVtYW5kLlxuLy8gUHJvY2VzcyBzaWduYWxzIC0gaHR0cDovL21hbjcub3JnL2xpbnV4L21hbi1wYWdlcy9tYW43L3NpZ25hbC43Lmh0bWxcbmV4cG9ydCBjbGFzcyBNYW5hZ2VTdWJwcm9jZXNzIGV4dGVuZHMgRXZlbnRFbWl0dGVyIHtcbiAgc3RhdGljIHN1YnByb2Nlc3NMaXN0ID0gW11cblxuICBzdGF0aWMgdGVybWluYXRlU3VicHJvY2VzcygpIHtcbiAgICBmb3IgKGxldCBzdWJwcm9jZXNzIG9mIE1hbmFnZVN1YnByb2Nlc3Muc3VicHJvY2Vzc0xpc3QpIHtcbiAgICAgIGlmICghc3VicHJvY2Vzcy5raWxsZWQpIHtcbiAgICAgICAgLy8gY29uc29sZS5sb2coJ3NlbmRpbmcga2lsbCB0byBzdWJwcm9jZXNzICcgKyBzdWJwcm9jZXNzLnBpZClcbiAgICAgICAgc3VicHJvY2Vzcy5raWxsKCdTSUdURVJNJylcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBzdWJwcm9jZXNzIC8vIGNoaWxkIHN1YnByb2Nlc3NcbiAgY2xpQWRhcHRlclBhdGggLy8gdGhlIHBhdGggdG8gdGhlIGNsaSBlbnRyeXBvaW50IGZpbGUsIHRoYXQgd2lsbCByZWNlaXZlIGFyZ3VtZW50cyBmcm9tIHRoZSBjaGlsZCBwcm9jZXNzIGZvcmsgZnVuY3Rpb24gYW5kIHBhc3MgaXQgdG8gdGhlIHByb2dyYW1tYXRpYyBtb2R1bGUgYXBpLlxuICBhcmd1bWVudExpc3QgLy8gY2FjaGVkIGFyZ3VtZW50cyB0byBiZSB1c2VkIGZvciBydW5uaW5nIHN1YnByb2Nlc3Nlc1xuXG4gIGNvbnN0cnVjdG9yKHsgY2xpQWRhcHRlclBhdGggfSkge1xuICAgIHN1cGVyKClcbiAgICB0aGlzLmNsaUFkYXB0ZXJQYXRoID0gY2xpQWRhcHRlclBhdGhcbiAgICB0aGlzLnN1cHJvY2VzcyA9IG51bGxcbiAgfVxuXG4gIHJ1bkluU3VicHJvY2VzcygpIHtcbiAgICBpZiAodGhpcy5zdWJwcm9jZXNzKSB0aGlzLnN1YnByb2Nlc3Mua2lsbCgnU0lHVEVSTScpXG5cbiAgICB0aGlzLmFyZ3VtZW50TGlzdCA9IFsuLi4oYXJndW1lbnRzLmxlbmd0aCA9PSAwID8gdGhpcy5hcmd1bWVudExpc3QgfHwgW10gOiBhcmd1bWVudHMpXVxuXG4gICAgbGV0IHN0cmluZ2lmeUFyZ3MgPSBKU09OLnN0cmluZ2lmeSh0aGlzLmFyZ3VtZW50TGlzdCkgLy8gcGFyYW1ldHJzIGZvciBtb2R1bGUgdG8gYmUgcnVuIGluIHN1YnByb2Nlc3MuXG4gICAgLy8gcnVubmluZyBpbiBzdWJwcm9jZXNzIHByZXZlbnRzIGFsbG93cyB0byBjb250cm9sIHRoZSBhcHBsaWNhdGlvbiBhbmQgdGVybWluYXRlIGl0IHdoZW4gbmVlZGVkLlxuICAgIHRoaXMuc3VicHJvY2VzcyA9IGNoaWxkUHJvY2Vzc1xuICAgICAgLmZvcmsodGhpcy5jbGlBZGFwdGVyUGF0aCwgW3N0cmluZ2lmeUFyZ3NdLCB7XG4gICAgICAgIHN0ZGlvOiBbMCwgMSwgMiwgJ2lwYyddLFxuICAgICAgICBleGVjQXJndjogW1xuICAgICAgICAgIC8vICctLWluc3BlY3QtYnJrPTEyNzInLCAvLyBpbnNwZWN0IHN1YnByb2Nlc3Mgd2l0aCByYW5kb20gcG9ydCB0byBwcmV2ZW50IGNvbmZsaWN0cyB3aXRoIHRoZSBtYWluIHByb2Nlc3MgaW4gY2FzZSBpdCdzIGluc3BlY3QgZmxhZyB3YXMgdHVybmVkIG9uLlxuICAgICAgICAgICctLW5vLWxhenknLCAvLyBmb3IgZGVidWdnaW5nIHB1cnBvc2VzIHdpbGwgbG9hZCBtb2R1bGVzIHNlcXVlbnRpYWxseVxuICAgICAgICBdLFxuICAgICAgfSlcbiAgICAgIC5vbignbWVzc2FnZScsIG1lc3NhZ2UgPT4ge1xuICAgICAgICBpZiAobWVzc2FnZT8uc3RhdHVzID09ICdyZWFkeScpIHRoaXMuZW1pdCgncmVhZHknKVxuICAgICAgfSlcbiAgICAgIC5vbignY2xvc2UnLCBjb2RlID0+IHtcbiAgICAgICAgaWYgKGNvZGUgPT09IDgpIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGRldGVjdGVkLCB3YWl0aW5nIGZvciBjaGFuZ2VzLicpXG4gICAgICB9KVxuICAgICAgLy8gY2hpbGRQcm9jZXNzLnVucmVmKCkgLy8gcHJldmVudCBwYXJlbnQgZnJvbSB3YWl0aW5nIHRvIGNoaWxkIHByb2Nlc3MgYW5kIHVuIHJlZmVyZW5jZSBjaGlsZCBmcm9tIHBhcmVudCdzIGV2ZW50IGxvb3AuIFdoZW4gY2hpbGQgcHJvY2VzcyBpcyByZWZlcmVuY2VkIGl0IGZvcmNlcyB0aGUgcGFyZW50IHRvIHdhaXQgZm9yIHRoZSBjaGlsZCB0byBleGl0IGJlZm9yZSBleGl0aW5nIGl0c2VsZi5cblxuICAgIHRoaXMuc3VicHJvY2Vzcy5vbignZXhpdCcsIChjb2RlLCBzaWduYWwpID0+IGNvbnNvbGUubG9nKGBbU3VicHJvY2VzcyAke3RoaXMuc3VicHJvY2Vzcy5waWR9XTogc2lnbmFsICR7c2lnbmFsfSwgY29kZSAke2NvZGV9O2ApKVxuXG4gICAgTWFuYWdlU3VicHJvY2Vzcy5zdWJwcm9jZXNzTGlzdC5wdXNoKHRoaXMuc3VicHJvY2VzcylcblxuICAgIHJldHVybiB0aGlzLnN1YnByb2Nlc3NcbiAgfVxufVxuXG4vLyBjbGVhbiB1cCBpZiBhbiBlcnJvciBnb2VzIHVuaGFuZGxlZCBvciBpbnRlcnJ1cHQgc2lnbmFsIHJlY2VpdmVkLlxuLy8gVE9ETzogbWFrZSBzdXJlIHRoZSBob29rcyBmb3IgcHJvY2VzcyBldmVudHMgYXJlIG5vdCBleGVjdXRlZC5cbi8vIHByb2Nlc3MuZXhpdCgwKSAvLyBwcm9jZXNzLmFib3J0KCkgIC8vIHByb2Nlc3Mua2lsbCgpXG4vLyBwcm9jZXNzLm9uKCdleGl0JywgKGNvZGUsIHNpZ25hbCkgPT4ge1xuLy8gICBjb25zb2xlLmxvZyhgW1Byb2Nlc3MgJHtwcm9jZXNzLnBpZH1dOiBzaWduYWwgJHtzaWduYWx9LCBjb2RlICR7Y29kZX07YClcbi8vICAgTWFuYWdlU3VicHJvY2Vzcy50ZXJtaW5hdGVTdWJwcm9jZXNzKClcbi8vIH0pXG4vLyBwcm9jZXNzLm9uKCdjbG9zZScsIChjb2RlLCBzaWduYWwpID0+IGNvbnNvbGUubG9nKGBbUHJvY2VzcyAke3Byb2Nlc3MucGlkfV06IHNpZ25hbCAke3NpZ25hbH0sIGNvZGUgJHtjb2RlfTtgKSlcbi8vIHByb2Nlc3Mub24oJ1NJR1RFUk0nLCAoY29kZSwgc2lnbmFsKSA9PiBjb25zb2xlLmxvZyhgW1Byb2Nlc3MgJHtwcm9jZXNzLnBpZH1dOiBzaWduYWwgJHtzaWduYWx9LCBjb2RlICR7Y29kZX07YCkpXG5wcm9jZXNzLm9uKCdTSUdJTlQnLCAoY29kZSwgc2lnbmFsKSA9PiB7XG4gIGNvbnNvbGUubG9nKGBbUHJvY2VzcyAke3Byb2Nlc3MucGlkfV06IHNpZ25hbCAke3NpZ25hbH0sIGNvZGUgJHtjb2RlfTtgKVxuICBNYW5hZ2VTdWJwcm9jZXNzLnRlcm1pbmF0ZVN1YnByb2Nlc3MoKVxufSlcbiJdfQ==